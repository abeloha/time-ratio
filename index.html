<!DOCTYPE html>
<html>
  
<head>
    <meta charset="utf-8">
    <title>AFCSC | Timer</title>
    <meta name="description" content="Your description here">
    <meta name="keywords" content="Your keywords here">
    <meta name="author" content="The author here">
    
    <!-- Mobile meta tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="HTML5 Template">
    
    <!-- Start Header styles -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/jquery.fullPage.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- End Header styles-->
    
    <!--Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,700italic,400,300,700&amp;subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,300,700,100&amp;subset=latin,latin-ext,cyrillic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic&amp;subset=latin,cyrillic' rel='stylesheet' type='text/css'>
    
    <!-- Favion -->
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <!-- Apple touch icon -->
    <link rel="apple-touch-icon" href="apple-touch-icon-precomposed.png">
    
  </head>
  <body>
    <!-- Start Loader -->
    <div class='loading'>
      <div class='loader'>
        <img height='70' src='images/loader.svg' width='70'>
      </div>
    </div>
    <!-- End Loader -->
    
    <!-- Start Header -->
    <header class='page-header' id='page-header'>
      <div class='container'>
        <div>
          <div class='navbar-header'>
            <!-- Logo -->
            <a class='logo animated onstart' data-animation-delay='200' data-animation='fadeInDown' href='#'>
              AFCSC
            </a>
            
            <button aria-expanded='false' class='navbar-toggle collapsed' data-target='#header-nav' data-toggle='collapse' type='button'>
              <span class='icon-bar top-bar'></span>
              <span class='icon-bar middle-bar'></span>
              <span class='icon-bar bottom-bar'></span>
            </button>
          </div>
          
          <!-- Header navigation -->
          <nav class='header-nav navbar-collapse collapse' id='header-nav'>
            <ul class='js-section-nav'>
              <li data-menuanchor='welcome'>
                <a class='animated onstart' data-animation-delay='1000' data-animation='fadeInDown' href='#welcome'>
                  Clock
                </a>
              </li>
              <li data-menuanchor='contacts'>
                <a class='animated onstart' data-animation-delay='1400' data-animation='fadeInDown' href='#about'>
                  Settings
                </a>
              </li>
            </ul>
          </nav>
          <!-- End Header navigation -->
          
        </div>
      </div>
    </header>
    <!-- End Header -->
    
    <div class='page-wrap' id='fullpage'>
      
      <!-- Start Welcome -->
      <section class='welcome section-content section'>
        <div class='page-background bg-midnight-blue'></div>
        <div class='container'>
          <div class='text-center'>
            <h2 class='section-title animated onstart' data-animation='fadeInDown'>
              <span class="highlight f-bold">Exercise Time: </span> <span id="exDate"></span>
            </h2>

            <div id="clock" class="onstart animated">
                <div class="number" id="exClock"> </div>
            </div>

            <hr>
            
            <h3 class='section-title animated onstart' data-animation='fadeInDown'>
              <span class="f-bold">Real Time: </span> <span id="realDate"></span>
            </h3>

            <div class="onstart animated">
                <h1> <span id="realClock"></span> </h1>
            </div>
           

          </div>
        </div>
      </section>
      <!-- End Welcome -->
      
      
      <!-- Start Contacts -->
      <section class='section-content contacts section'>
        <div class='page-background bg-green-sea'></div>
        <div class='container'>
          <h1 class='section-title animated' data-animation='fadeInDown'>
            Settings
          </h1>
          <div class='row'>
            <div class='col-sm-8 col-sm-offset-2'>
              <form class='mg-b' id="formSet" method="POST">
                <div class='form-wrap'>

                  <div class='col-sm-12'>
                    <b>Ratio (real : exercise)</b>
                    <div class='row'>

                      <div class='col-sm-6'>
                        <div class='form-group'>
                          <input class='form-control border-bottom' type="number" name="real_ratio" id="real_ratio" value="1" min="1" placeholder=''>
                        </div>
                      </div>

                      <div class='col-sm-6'>
                        <div class='form-group'>
                          <input class='form-control border-bottom' type="number" name="ex_ratio" id="ex_ratio" value="1" min="1" placeholder=''>
                        </div>
                      </div>

                    </div>
                  </div>

                  <div class='col-sm-12'>
                    <b>Exercise time start at</b>
                    <div class='row'>
                    <div class='col-sm-6'>
                      <div class='form-group'>
                        <input class='form-control border-bottom' type="date" value="" name="ex_start_date" id="ex_start_date" placeholder='Start date'required>
                      </div>
                    </div>

                    <div class='col-sm-6'>
                      <div class='form-group'>
                        <input class='form-control border-bottom' type="time" value="" name="ex_start_time" id="ex_start_time" placeholder='Start time' required>
                      </div>
                    </div>

                  </div>
                  </div>
                  

                  <div class='form-group mg-t text-center'>
                    <button class='btn btn-outline btn-submit animated' data-animation='fadeInUp' type='submit'>
                      Set
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
      <!-- End Contacts -->


      <!-- Start Footer -->
    <footer class='page-footer'>
      <div class='container'>
        <div class='row'>
          <div class='col-sm-6 col-sm-push-6'>
            <div class='social-nav'>
              <ul>
                <li> <span id="real_ratio_display"></span> </li>
                <li> : </li>
                <li> <span id="ex_ratio_display"></span> </li>
              </ul>
            </div>
          </div>
          <div class='col-sm-6 col-sm-pull-6'>
            <div class='copyright'> Exercise Start At: <span id="ex_start_at_display"></span></div>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer -->
    </div>
    
    <!-- Start Scripts -->
    <script src="js/jquery-2.1.4.min.js"></script>
    
    <script src="js/jquery.easing.1.3.js"></script>
    
    <!-- Bootsrap plugins -->
    <script src="js/bootstrap.min.js"></script>
    
    <!-- Countdown -->
    <script src="js/jquery.countdown.js"></script>
    
    <!-- Youtube player -->
    <script src="js/jquery.mb.YTPlayer.js"></script>
    
    <!-- Others -->
    <script src="js/jquery.fullPage.min.js"></script>
    <script src="js/jquery.appear.js"></script>
    <script src="js/jquery.fitvids.js"></script>
    <script src="js/jquery.backstretch.min.js"></script>
    <script src="js/owl.carousel.js"></script>
    
    <!-- Mailchimp -->
    <script src="js/jquery.ajaxchimp.js"></script>
    
    <!-- Particles -->
    <script src="js/particles.js"></script>
    
    <!-- Moment -->
    <script src="js/moment.js"></script>
    
    <!-- Main -->
    <script src="js/main.js"></script>
    <!-- End Scripts -->

    <script type="text/javascript">

      var ex_start_date_time = '';
      var ratio = 1;

      var dateTimeFormat = 'YYYY-MM-DD HH:mm:ss';
      var dateFormat = 'YYYY-MM-DD';
      var timeFormat = 'HH : mm : ss';

      setValue();
      const interval = setInterval(() => {
          setDate();
      }, 1000); //milisec

      $('#formSet').on('submit',function(e){
          e.preventDefault();
          setValue();
          document.getElementById('fullpage').scrollIntoView();
      });

      function setValue(){
        var now = new Date();
        var momentNow = moment(now, dateTimeFormat);

        let ex_start_date = $('#ex_start_date').val();
        let ex_start_time = $('#ex_start_time').val();

        if(ex_start_date == ''){
          ex_start_date = momentNow.format(dateFormat);
          $('#ex_start_date').val(ex_start_date);
        }

        if(ex_start_time == ''){
          ex_start_time = momentNow.format(timeFormat);
          $('#ex_start_time').val(momentNow.format('HH:mm'));
        }

        ex_start_date_time = moment(ex_start_date + ' ' + ex_start_time, dateTimeFormat);

        let real_ratio = $('#real_ratio').val();
        let ex_ratio = $('#ex_ratio').val();


        $('#ex_start_at_display').text(ex_start_date_time);
        $('#real_ratio_display').text(real_ratio);
        $('#ex_ratio_display').text(ex_ratio);

        ratio = ex_ratio / real_ratio;
        
      }


      function setDate(){
        var exClock = '';
        var exDate = '';

        var realDate = '';
        var realClock = '';

        var now = new Date();
        var momentNow = moment(now, dateTimeFormat);

        realClock = momentNow.format(timeFormat);
        realDate = momentNow.format(dateFormat);

        momentExStart = moment(ex_start_date_time, dateTimeFormat);
        var diffSec = moment(momentNow, dateTimeFormat).diff(momentExStart, 'seconds');
        
        if(diffSec < 0 || ratio == 1){
          exClock = realClock;
          exDate = realDate;
          console.log('exercise date not started or ration = 1');
        }else{

          var exFactorSec = diffSec * ratio;

          var newExDateTimeMoment = momentExStart.add(exFactorSec, 'seconds');

          exClock = newExDateTimeMoment.format(timeFormat);
          exDate = newExDateTimeMoment.format(dateFormat);
        }
        

        $('#exClock').text(exClock);
        $('#exDate').text(exDate);
        $('#realDate').text(realDate);
        $('#realClock').text(realClock);
      }

    </script>

  </body>
</html>
